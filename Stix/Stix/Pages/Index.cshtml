@page
@model IndexModel
@{
    ViewData["Title"] = "STIX";
}

<script src="/js/jquery 3.6.0.js"> </script>
<p class="text-white">
    @Model.title
    @Model.date
</p>
<div class="filterSortContainer d-flex justify-content-between h-auto">
    <div>
        <input placeholder="Search..." id="search_txt" type="text">
    </div>
    <div class="d-flex flex-row">
        <a href="" class="link-light"><button class="btn btn-secondary btn-outline-dark">Export</button></a>
        <div class="drodown">
            <button id="dropdownButton" type="button" class="btn btn-secondary btn-outline-dark dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false"
                    aria-haspopup="true" data-bs-auto-close="outside">
                Sort
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownButton">
                <a class="dropdown-item">Action</a>
            </div>
        </div>
        <form method="post" enctype="multipart/form-data">
            <button type="submit" class="btn btn-secondary btn-outline-dark">Filter</button>
        </form>
    </div>
</div>
<br />
<br />
<br />
<br />
<div class="overviewTableContainer flex">
    <table class="overviewTable">
        <tr>
            @{
                @if (@Model.title)
                {
                    <th class="incidentHeader">Title</th>
                }
                @if (@Model.summary)
                {
                    <th class="descriptionHeader">Description</th>
                }
                @if (@Model.date)
                {
                    <th class="addedOnHeader">Added On</th>
                }
                @if (@Model.additional_info)
                {
                    <th>Additional Information</th>
                }
            }
            <th class="viewMoreHeader">View More</th>
        </tr>
        <!-- loop, can change it to just grab everything from a db-->
        @*@foreach(@ViewData.incident in @ViewData.incidentList)*@
        @foreach (var item in @Model.incidentList)
        {
            <tr>
                @if (@Model.title)
                {
                    <td class="centerTableCell">@item.title</td>
                }
                @if (@Model.summary)
                {
                    <td class="centerTableCell">@item.summary</td>
                }
                @if (@Model.date)
                {
                    <td class="centerTableCell">@item.month - @item.year</td>
                }
                @if (@Model.additional_info)
                {
                    <td class="centerTableCell">@item.additionalInfo</td>
                }
                <td class="rightTableCell"><a href="Incident/?id=@item.id">X</a></td>
            </tr>
        }
    </table>

    @section scripts{
        <script type="text/javascript">
            $(function() {
                $.get('/Index/Incidents').done(function(incidents) {
                    $.each(incidents, function(i, incident) {
                        var item = `<li>
                                                                                                                                <strong>${incident.id} ${incident.referenceID}</strong>
                                                                                                                                (£${incident.pending})</li>`;
                        $('#incident-list').append(item);
                    });
                });
            });

            $(document).ready(function() {
                $('#search_txt').keyup(function() {
                    var search = $(this).val();

                    $('table tbody tr').hide();

                    var len = $('table tbody tr:not(.not-found) td:contains("' + search + '")').length;

                    if (len > 0) {
                        $('table tbody tr:not(.not-found) td:contains("' + search + '")').each(function() {
                            $(this).closest('tr').show();
                        });
                    } else {
                        $('.not-found').show();
                    }
                });
            });

            $.expr[":"].contains = $.expr.createPseudo(function(arg) {
                return function(elem) {
                    return $(elem).text().toUpperCase().indexOf(arg.toUpperCase()) >= 0;
                };
        </script>
    }
    </div>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
